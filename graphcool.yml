types:
  - ./types/post.graphql
  - ./types/user.graphql

functions:
  authenticate:
    handler:
      code:
        src: ./functions/resolvers/auth0/auth0Authentication.js
        environment:
          AUTH0_DOMAIN: ${env:AUTH0_DOMAIN}
          AUTH0_API_IDENTIFIER: ${env:AUTH0_API_IDENTIFIER}
    type: resolver
    schema: ./functions/resolvers/auth0/auth0Authentication.graphql

  sayHelloPost:
    type: operationAfter
    operation: Post.create
    handler:
      code: functions/hooks/sayHelloPost.js

  syncAlgolia:
    type: subscription
    query: functions/subscriptions/algolia/userSync.graphql
    handler:
      code:
        src: ./functions/subscriptions/algolia/userSync.js
        environment:
          ALGOLIA_APP_ID: ${env:ALGOLIA_APP_ID}
          ALGOLIA_API_KEY: ${env:ALGOLIA_API_KEY}

  latestPosts:
    type: resolver
    schema: functions/resolvers/latestPosts.graphql
    handler:
      code: functions/resolvers/latestPosts.js

permissions:
  - operation: "*"
